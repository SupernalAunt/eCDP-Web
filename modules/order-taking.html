<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Order Taking - Cheeseburger Builder</title>
  <link rel="stylesheet" href="../style.css" />
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
  <style>
    .ingredient {
      padding: 8px;
      margin: 5px;
      border-radius: 5px;
      cursor: grab;
      color: white;
      font-weight: bold;
    }
    .slot {
      width: 120px;
      height: 30px;
      margin: 5px auto;
      border: 2px dashed #ccc;
      text-align: center;
      line-height: 30px;
      font-weight: bold;
    }
    .happy {
      color: green;
      font-size: 1.2em;
    }
    .sad {
      color: red;
      font-size: 1.2em;
    }
    .material-icons.large {
      font-size: 48px;
      color: red;
      vertical-align: middle;
    }
  </style>
</head>
<body>
  <div id="orderModule" class="container">
    <h2>Customer Order: <span id="orderName"></span></h2>
    <div id="timer">Time Left: <span id="time">180</span>s</div>
    <div id="score">Score: <span id="points">0</span></div>

    <h3>Drag Ingredients into the Burger Stack</h3>
    <div id="ingredientTray"></div>
    <div id="burgerStack"></div>

    <button onclick="submitBurger()">Submit Order</button>
    <div id="feedback"></div>
  </div>

  <audio id="bgMusic" src="../assets/audio/BG_03.wav" loop autoplay></audio>

  <script>
    const ingredients = {
      "bun-top": "#d4a373",
      "ketchup": "#ff0000",
      "mustard": "#ffcc00",
      "pickles": "#66bb66",
      "onions": "#cccccc",
      "cheese": "#ffcc66",
      "patty": "#663300",
      "bun-bottom": "#d4a373"
    };

    const scenarios = [
      { name: "Standard Cheeseburger", order: ["bun-top", "ketchup", "mustard", "pickles", "onions", "cheese", "patty", "bun-bottom"] },
      { name: "Plain Cheeseburger", order: ["bun-top", "cheese", "patty", "bun-bottom"] },
      { name: "No Pickles", order: ["bun-top", "ketchup", "mustard", "onions", "cheese", "patty", "bun-bottom"] },
      { name: "Extra Cheese", order: ["bun-top", "ketchup", "mustard", "pickles", "onions", "cheese", "cheese", "patty", "bun-bottom"] },
      { name: "Double Patty", order: ["bun-top", "ketchup", "mustard", "pickles", "onions", "cheese", "patty", "patty", "bun-bottom"] }
    ];

    const selected = scenarios[Math.floor(Math.random() * scenarios.length)];
    document.getElementById("orderName").textContent = selected.name;

    const tray = document.getElementById("ingredientTray");
    const stack = document.getElementById("burgerStack");

    Object.entries(ingredients).forEach(([name, color]) => {
      const item = document.createElement("div");
      item.className = "ingredient";
      item.draggable = true;
      item.textContent = name;
      item.style.backgroundColor = color;
      item.dataset.name = name;
      item.addEventListener("dragstart", e => {
        e.dataTransfer.setData("text/plain", name);
      });
      tray.appendChild(item);
    });

    for (let i = 0; i < selected.order.length; i++) {
      const slot = document.createElement("div");
      slot.className = "slot";
      slot.addEventListener("dragover", e => e.preventDefault());
      slot.addEventListener("drop", e => {
        const name = e.dataTransfer.getData("text/plain");
        slot.textContent = name;
        slot.style.backgroundColor = ingredients[name] || "#999";
        slot.dataset.name = name;
      });
      stack.appendChild(slot);
    }

    let timeLeft = 180;
    const timer = setInterval(() => {
      timeLeft--;
      document.getElementById("time").textContent = timeLeft;
      if (timeLeft <= 0) {
        clearInterval(timer);
        submitBurger();
      }
    }, 1000);

    function submitBurger() {
      clearInterval(timer);
      const slots = Array.from(document.querySelectorAll(".slot"))
        .map(s => s.dataset.name)
        .filter(name => name); // Ignore empty slots

      const correct = selected.order;
      let score = 0;

      for (let i = 0; i < correct.length; i++) {
        if (slots[i] === correct[i]) score += 10;
      }

      document.getElementById("points").textContent = score;

      let feedback = "";
      if (score === correct.length * 10) {
        feedback = "<p class='happy'>ðŸ˜Š Perfect! Customer is happy!</p>";
      } else if (score >= correct.length * 7) {
        feedback = "<p class='happy'>ðŸ™‚ Good job! Minor mistakes.</p>";
      } else {
        feedback = "<p class='sad'><span class='material-icons large'>close</span> Incorrect build. Customer is upset.</p>";
      }

      document.getElementById("feedback").innerHTML = feedback;
    }
  </script>
</body>
</html>
